<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stylus Drag Trail (Fixed)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      touch-action: none;
    }

    #wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    #trail-canvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 0;
    }

    #cursor-dot {
      position: absolute;
      width: 24px;
      height: 24px;
      background: orange;
      border-radius: 50%;
      pointer-events: none;
      z-index: 10;
      display: none;
    }
  </style>
</head>
<body>
  <div id="wrapper">
    <canvas id="trail-canvas"></canvas>
    <div id="cursor-dot"></div>
  </div>

  <script>
    const dot = document.getElementById("cursor-dot");
    const canvas = document.getElementById("trail-canvas");
    const ctx = canvas.getContext("2d");
    const wrapper = document.getElementById("wrapper");

    let dragging = false;
    let trail = [];
    let mouse = { x: 0, y: 0 };

    function resizeCanvas() {
      canvas.width = wrapper.clientWidth;
      canvas.height = wrapper.clientHeight;
    }

    // Ensure correct sizing on load and resize
    window.addEventListener("resize", resizeCanvas);
    window.visualViewport?.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    function updatePosition(x, y) {
      mouse.x = x;
      mouse.y = y;
    }

    function positionDot() {
      if (dragging) {
        dot.style.left = (mouse.x - 12) + "px";
        dot.style.top = (mouse.y - 12) + "px";
      }
    }

    function onPointerDown(e) {
      if (!e.isPrimary) return;
      dragging = true;
      dot.style.display = "block";
      updatePosition(e.clientX, e.clientY);
      positionDot();
      canvas.setPointerCapture?.(e.pointerId);
    }

    function onPointerMove(e) {
      if (!e.isPrimary) return;
      updatePosition(e.clientX, e.clientY);
    }

    function onPointerUp(e) {
      if (!e.isPrimary) return;
      dragging = false;
      dot.style.display = "none";
      trail = [];
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    canvas.addEventListener("pointerdown", onPointerDown);
    canvas.addEventListener("pointermove", onPointerMove);
    canvas.addEventListener("pointerup", onPointerUp);
    canvas.addEventListener("pointercancel", onPointerUp);

    function animate() {
      requestAnimationFrame(animate);
      positionDot();

      if (dragging) {
        trail.push({ x: mouse.x, y: mouse.y });
        if (trail.length > 15) trail.shift();
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (dragging && trail.length > 1) {
        ctx.beginPath();
        for (let i = 0; i < trail.length; i++) {
          const point = trail[i];
          if (i === 0) ctx.moveTo(point.x, point.y);
          else ctx.lineTo(point.x, point.y);
        }
        ctx.strokeStyle = "orange";
        ctx.lineWidth = 18;
        ctx.lineCap = "round";
        ctx.stroke();
      }
    }

    animate();
  </script>
</body>
</html>
